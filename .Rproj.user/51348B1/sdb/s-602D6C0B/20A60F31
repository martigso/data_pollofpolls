{
    "collab_server" : "",
    "contents" : "rm(list = ls())\n\nlibrary(rvest);library(dplyr);library(ggplot2)\nlibrary(pbmcapply);library(reshape2)\n\nmaling <- list.files(\"./scrape/www.pollofpolls.no/\", pattern = \"?cmd=Stortinget&fylke=\", full.names = TRUE)\n\nfylker <- function(x){\n  \n  raw <- read_html(x, encoding = \"utf-8\")\n  \n  df <- data.frame((raw %>% html_nodes(\"table\"))[3] %>% html_table())\n  \n  links <- (raw %>% html_nodes(\"table\"))[3] %>% html_nodes(\"a\") %>% html_attr(\"href\")\n  df$maling_link <- unique(links[which(grepl(\"gallupid\", links))])\n  \n  df$fylke <- gsub(\"Stortingsvalg: \", \"\", (raw %>% html_nodes(\"h1\") %>% html_text())[2])\n  \n  return(df)\n}\n\n\nfylker(maling[28])\n\nsort(maling)\n\ntest <- lapply(maling[which(grepl(\"\\\\=([0-9]{1,2})$\", maling))][-1], fylker)\n\ntest <- bind_rows(test)\n\nread_maling <- function(x){\n  raw <- read_html(paste0(\"./scrape/www.pollofpolls.no//index.html\", x), encoding = \"utf-8\")\n  \n  df <- data.frame(matrix(nrow = 1, ncol = 2, dimnames = list(1, c(\"N\", \"id\"))))\n  df$N <- (raw %>% html_table())[[2]][4, 2]\n  df$id <- x\n  return(df)\n}\n\nhei <- pbmclapply(test$maling, read_maling, mc.cores = detectCores()-1)\n\nhei <- bind_rows(hei)\n\ntest <- merge(x = test, y = hei, by.x = \"maling_link\", by.y = \"id\", all.x = TRUE)\nhead(test)\ntest2 <- melt(test, measure.vars =c(\"Ap\", \"Høyre\", \"Frp\", \"SV\", \"Sp\", \"KrF\", \"Venstre\", \"MDG\", \"Rødt\", \"Andre\"), variable.name = \"parti\", value.name = \"prosent\")\ntest2$N <- as.integer(test2$N)\n\ntest2$mandat <- as.integer(gsub(\"\\\\(|\\\\)\", \"\", stringr::str_extract_all(test2$prosent, \"\\\\([0-9]+\\\\)\", simplify = TRUE)))\ntest2$prosent <- as.numeric(stringr::str_trim(gsub(\"\\\\,\", \".\", gsub(\"\\\\([0-9]+\\\\)\", \"\", test2$prosent))))\ntest2$stemmer <- round((test2$N / 100) * test2$prosent, digits = 0)\n\n\ntest2$Dato <- as.Date(test2$Dato, format = \"%d/%m-%Y\")\n\n\n\n\n\n\n",
    "created" : 1504947637512.000,
    "dirty" : true,
    "encoding" : "",
    "folds" : "",
    "hash" : "3514556599",
    "id" : "20A60F31",
    "lastKnownWriteTime" : 53112976,
    "last_content_update" : 1504954115951,
    "path" : null,
    "project_path" : null,
    "properties" : {
        "tempName" : "Untitled1"
    },
    "relative_order" : 1,
    "source_on_save" : false,
    "source_window" : "",
    "type" : "r_source"
}